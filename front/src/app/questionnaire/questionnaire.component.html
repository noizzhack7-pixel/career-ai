<div class="questionnaire-container" [dir]="'rtl'">
  <!-- Loading State -->
  <div *ngIf="assessmentStore.isLoading() && !assessmentStore.isSubmitted()" class="loading">
    <div class="spinner"></div>
    <p class="text-neutral-dark font-medium">טוען הערכה...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="assessmentStore.error()" class="error-message">
    <p>{{ assessmentStore.error() }}</p>
    <button (click)="assessmentStore.loadQuestions(assessmentStore.isTestMode())" class="btn-retry">נסה שוב</button>
  </div>

  <!-- Assessment Form -->
  <div *ngIf="!assessmentStore.isLoading() && !assessmentStore.isSubmitted() && assessmentStore.questions().length > 0" class="assessment-form">
    <div class="assessment-header">
      <div class="flex items-center justify-between mb-4">
        <h2 class="flex items-center gap-3">
          <i class="fa-solid fa-list-check text-accent-dark"></i>
          שאלון התאמה
          <span *ngIf="assessmentStore.isTestMode()" class="test-badge">מצב בדיקה</span>
        </h2>
        <a routerLink="/" class="text-sm text-primary hover:underline font-semibold flex items-center gap-2">
          <i class="fa-solid fa-arrow-right"></i>
          חזרה לדף הבית
        </a>
      </div>
      <p class="subtitle">ענה על כל השאלות כדי לזהות את החוזקות המקצועיות שלך ולשפר את איכות ההתאמות</p>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="assessmentStore.progressPercentage()"></div>
        <span class="progress-text">{{ assessmentStore.answeredCount() }} / {{ assessmentStore.questions().length }} נענו</span>
      </div>
    </div>

    <!-- Questions -->
    <div class="questions-section">
      <div *ngFor="let question of assessmentStore.currentQuestions()" class="question-card" [id]="'question-' + question.id">
        <div class="question-header">
          <span class="question-number">
            <i class="fa-solid fa-circle-question ml-1"></i>
            שאלה {{ question.id }}
          </span>
          <span class="question-category">{{ question.category }}</span>
        </div>
        <p class="question-text">{{ question.text }}</p>
        <div class="rating-scale">
          <label *ngFor="let score of [1, 2, 3, 4, 5]" class="rating-option">
            <input type="radio" [name]="'question-' + question.id" [value]="score"
              [checked]="getAnswer(question.id) === score" (change)="setAnswer(question.id, score)" />
            <span class="rating-label">
              <span class="rating-number">{{ score }}</span>
              <span class="rating-text" *ngIf="score === 1">בכלל לא מסכים</span>
              <span class="rating-text" *ngIf="score === 2">לא מסכים</span>
              <span class="rating-text" *ngIf="score === 3">ניטרלי</span>
              <span class="rating-text" *ngIf="score === 4">מסכים</span>
              <span class="rating-text" *ngIf="score === 5">מסכים מאוד</span>
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="pagination">
      <!-- Back Button (on the left in RTL) -->
      <button (click)="previousPage()" [disabled]="assessmentStore.isFirstPage()" class="btn-nav btn-prev">
        <i class="fa-solid fa-arrow-right ml-2"></i>
        הקודם
      </button>

      <!-- Submit Button (on last page) -->
      <button *ngIf="assessmentStore.isLastPage()" (click)="submitAssessment()" [disabled]="!assessmentStore.isCurrentPageComplete() || assessmentStore.isLoading()"
        class="btn-submit">
        <i class="fa-solid fa-paper-plane ml-2"></i>
        {{ assessmentStore.isLoading() ? 'שולח...' : 'שלח הערכה' }}
      </button>

      <!-- Page indicator text -->
      <span class="page-indicator-text">עמוד {{ assessmentStore.currentPage() + 1 }} מתוך {{ assessmentStore.totalPages() }}</span>

      <!-- Next/Submit Button (on the right in RTL) -->
      <button *ngIf="!assessmentStore.isLastPage()" (click)="nextPage()" [disabled]="!assessmentStore.isCurrentPageComplete()" class="btn-nav btn-next">
        הבא
        <i class="fa-solid fa-arrow-left mr-2"></i>
      </button>
    </div>
  </div>

  <!-- Results Dashboard (RTL Layout) -->
  <div *ngIf="assessmentStore.isSubmitted() && assessmentStore.results()" class="results-dashboard">
    <div class="results-header">
      <div class="flex items-center justify-center gap-3 mb-2">
        <i class="fa-solid fa-sparkles text-accent-dark text-2xl"></i>
        <h1 class="main-title">פרופיל הכישורים שלך</h1>
      </div>
      <p class="subtitle-hebrew">סיכום התוצאות וניתוח נטיות תעסוקתיות</p>
      <div class="flex justify-center gap-3 mt-4">
        <button (click)="resetAssessment()" class="btn-reset">
          <i class="fa-solid fa-redo ml-2"></i>
          עשה הערכה שוב
        </button>
        <a routerLink="/" class="bg-primary text-white px-6 py-3 rounded-card font-semibold hover:bg-primary-dark transition-colors inline-flex items-center gap-2">
          <i class="fa-solid fa-home"></i>
          חזרה לדף הבית
        </a>
      </div>
    </div>

    <div class="results-content">
      <!-- Left Side: Radar Chart -->
      <div class="chart-section">
        <h3 class="section-title">
          <i class="fa-solid fa-chart-radar text-accent-dark"></i>
          מפת כישורים
        </h3>
        <div class="chart-container">
          <canvas baseChart [data]="radarChartData()" [options]="radarChartOptions" [type]="radarChartType">
          </canvas>
        </div>
      </div>

      <!-- Right Side: AI Insights -->
      <div class="insights-section">
        <h3 class="section-title">
          <i class="fa-solid fa-brain text-accent-dark"></i>
          פרופיל המיומנויות שלך
        </h3>

        <!-- AI Summary -->
        <div class="insight-box">
          <h4 class="insight-title">
            <span class="ai-icon"><i class="fa-solid fa-bolt"></i></span>
            ניתוח אישי
          </h4>
          <p class="insight-text">{{ assessmentStore.aiSummary() }}</p>
        </div>

        <!-- Top Strengths -->
        <div class="insight-box">
          <h4 class="insight-title">
            <i class="fa-solid fa-trophy text-accent-dark"></i>
            החוזקות שלך
          </h4>
          <ul class="strengths-list">
            <li *ngFor="let strength of assessmentStore.topStrengths()" class="strength-item">
              {{ strength }}
            </li>
          </ul>
        </div>

        <!-- Growth Recommendation -->
        <div class="insight-box">
          <h4 class="insight-title">
            <i class="fa-solid fa-lightbulb text-secondary"></i>
            המלצה להמשך
          </h4>
          <p class="insight-text">{{ assessmentStore.growthRecommendation() }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
