<!-- Loading State -->
<div *ngIf="isLoading()" class="min-h-screen flex items-center justify-center bg-neutral-extralight">
    <div class="text-center">
        <div class="w-12 h-12 border-4 border-primary/30 border-t-primary rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-neutral-dark font-medium">טוען נתונים...</p>
    </div>
</div>

<!-- Error State -->
<div *ngIf="error() && !isLoading()" class="min-h-screen flex items-center justify-center bg-neutral-extralight p-4">
    <div class="bg-white p-8 rounded-card shadow-card text-center max-w-md">
        <i class="fa-solid fa-exclamation-triangle text-4xl text-secondary mb-4"></i>
        <p class="text-neutral-dark mb-4">{{ error() }}</p>
        <button (click)="loadData()" class="bg-primary text-white px-6 py-2 rounded-card font-semibold hover:bg-primary-dark">
            נסה שוב
        </button>
    </div>
</div>

<!-- Main Content -->
<ng-container *ngIf="!isLoading() && !error() && employeeStore.profile()">
    <!-- Top Navigation -->
    <nav id="top-navigation" class="bg-white border-b border-neutral-light sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1600px] mx-auto px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-8">
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 bg-gradient-to-br from-primary to-accent-dark rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-rocket text-white text-lg"></i>
                        </div>
                        <span class="text-xl font-bold text-primary">GO-PRO</span>
                    </div>
                    
                    <div class="flex items-center gap-1">
                        <a routerLink="/" class="px-5 py-2.5 rounded-card text-sm font-semibold bg-primary-light/40 text-primary hover:bg-primary-light/60 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                            בית
                        </a>
                        <a href="#" class="px-5 py-2.5 rounded-card text-sm font-semibold text-neutral-dark hover:bg-primary-light/40 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                            כלל המשרות
                        </a>
                        <a href="#" class="px-5 py-2.5 rounded-card text-sm font-semibold text-neutral-dark hover:bg-primary-light/40 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                            התאמה ומסלול פיתוח
                        </a>
                        <a href="#" class="px-5 py-2.5 rounded-card text-sm font-semibold text-neutral-dark hover:bg-primary-light/40 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                            הפרופיל שלי
                        </a>
                    </div>
                </div>

                <div class="flex items-center gap-6">
                    <div class="relative w-72">
                        <label for="global-search" class="sr-only">חיפוש בשפה חופשית</label>
                        <input id="global-search" type="text" placeholder="חיפוש בשפה חופשית..." class="w-full bg-neutral-extralight border-2 border-neutral-light rounded-card py-2 pr-10 pl-4 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors" aria-label="שדה חיפוש גלובלי">
                        <i class="fa-solid fa-search absolute top-1/2 -translate-y-1/2 right-4 text-neutral-dark" aria-hidden="true"></i>
                    </div>

                    <div class="flex items-center gap-4">
                        <button class="relative text-neutral-dark hover:text-primary focus:outline-none focus:ring-2 focus:ring-primary rounded-full p-1" aria-label="התראות - יש 2 התראות חדשות">
                            <i class="fa-regular fa-bell text-xl" aria-hidden="true"></i>
                            <span class="absolute -top-1 -left-1 w-5 h-5 bg-secondary text-white text-xs rounded-full flex items-center justify-center font-bold" aria-label="2 התראות">2</span>
                        </button>
                        <div class="flex items-center gap-3 pr-4 border-r-2 border-neutral-light">
                            <img [src]="employeeStore.avatar()" [alt]="'תמונת פרופיל של ' + employeeStore.fullName()" class="w-9 h-9 rounded-full border-2 border-primary/40">
                            <div class="text-right">
                                <p class="text-sm font-semibold text-neutral-dark">{{ employeeStore.fullName() }}</p>
                                <p class="text-xs text-neutral-medium">{{ employeeStore.title() }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-home" class="max-w-[1600px] mx-auto p-10">
        <div class="grid grid-cols-12 gap-8 items-start">
            
            <!-- Center Column -->
            <div class="col-span-9 space-y-8">
                
                <!-- Personal Profile Section -->
                <section id="personal-profile-linkedin" class="bg-white rounded-card shadow-card overflow-hidden" aria-label="פרופיל אישי">
                    <div class="relative">
                        <div class="h-48 bg-primary/10 overflow-hidden">
                            <img class="w-full h-full object-cover" [src]="employeeStore.profile()!.cover_image" alt="" role="presentation" />
                            <button class="absolute top-4 left-4 w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-white transition-colors focus:outline-none focus:ring-2 focus:ring-primary" aria-label="שנה תמונת רקע">
                                <i class="fa-solid fa-camera text-neutral-dark" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="absolute top-28 right-8">
                             <img [src]="employeeStore.avatar()" [alt]="'תמונת פרופיל של ' + employeeStore.fullName()" class="w-40 h-40 rounded-full border-8 border-white shadow-lg">
                        </div>
                        <button class="absolute top-48 left-4 w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-white transition-colors focus:outline-none focus:ring-2 focus:ring-primary" aria-label="ערוך פרופיל">
                            <i class="fa-solid fa-pen text-neutral-dark" aria-hidden="true"></i>
                        </button>
                    </div>

                    <div class="pt-20 pb-6 px-8">
                        <div class="flex justify-between items-start">
                             <div>
                                <h1 class="text-3xl font-bold text-primary mb-1">{{ employeeStore.fullName() }}</h1>
                                <p class="text-lg font-semibold text-neutral-dark">{{ employeeStore.title() }}</p>
                                
                                <!-- Enhanced Organizational Assignment -->
                                <div class="mt-3 space-y-2" *ngIf="employeeStore.organization()">
                                    <div class="flex items-center gap-2 text-sm">
                                        <i class="fa-solid fa-building text-primary" aria-hidden="true"></i>
                                        <span class="font-semibold text-primary">{{ employeeStore.organization()!.division }}</span>
                                        <span class="text-neutral-medium">|</span>
                                        <span class="text-neutral-dark">{{ employeeStore.organization()!.department }}</span>
                                        <span class="text-neutral-medium">|</span>
                                        <span class="text-neutral-dark">{{ employeeStore.organization()!.team }}</span>
                                    </div>
                                    
                                    <div class="flex items-center gap-4 text-sm">
                                        <div class="flex items-center gap-2">
                                            <i class="fa-solid fa-calendar-days text-accent-dark text-xs" aria-hidden="true"></i>
                                            <span class="text-neutral-medium">ותק:</span>
                                            <span class="font-semibold text-neutral-dark">{{ employeeStore.profile()!.details.seniority }}</span>
                                        </div>
                                        <div class="w-px h-4 bg-neutral-medium"></div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa-solid fa-layer-group text-accent-dark text-xs" aria-hidden="true"></i>
                                            <span class="text-neutral-medium">דרגה:</span>
                                            <span class="font-semibold text-neutral-dark">{{ employeeStore.profile()!.details.grade }}</span>
                                        </div>
                                        <div class="w-px h-4 bg-neutral-medium"></div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa-solid fa-user-tie text-accent-dark text-xs" aria-hidden="true"></i>
                                            <span class="text-neutral-medium">מנהל/ת:</span>
                                            <span class="font-semibold text-neutral-dark">{{ employeeStore.profile()!.details.manager }}</span>
                                        </div>
                                    </div>
                                    
                                    <p class="text-sm text-neutral-medium flex items-center gap-2">
                                        <i class="fa-solid fa-location-dot text-accent-dark text-xs" aria-hidden="true"></i>
                                        {{ employeeStore.profile()!.details.location }}
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 mt-2">
                            </div>
                        </div>

                        <!-- Enhanced Metrics Section - Single Row Compact -->
                        <div class="mt-6 grid grid-cols-3 gap-3" *ngIf="employeeStore.metrics()">
                            <!-- Kudos Card - Compact -->
                            <div class="bg-gradient-to-br from-accent/10 to-accent/20 p-4 rounded-card border-2 border-accent/30 hover:border-accent/50 transition-all">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-card flex-shrink-0">
                                        <i class="fa-solid fa-trophy text-accent-dark text-xl" aria-hidden="true"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-baseline gap-2 mb-0.5">
                                            <p class="text-2xl font-bold text-accent-dark">{{ employeeStore.metrics()!.kudos }}</p>
                                        </div>
                                        <p class="text-xs text-neutral-dark font-medium">קודוס שצברתי</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Quality Card - Compact with Questionnaire CTA -->
                            <div class="bg-gradient-to-br from-primary/10 to-primary/20 p-4 rounded-card border-2 border-primary/30 hover:border-primary/50 transition-all">
                                <div class="flex items-center gap-3">
                                    <div class="relative w-12 h-12 flex-shrink-0">
                                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                            <path class="text-neutral-light" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3"></path>
                                            <path class="text-primary" [attr.stroke-dasharray]="employeeStore.dataQuality() + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"></path>
                                        </svg>
                                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                                            <p class="text-lg font-bold text-primary">{{ employeeStore.dataQuality() }}%</p>
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-xs text-neutral-dark font-medium mb-1">איכות נתונים</p>
                                        <button (click)="scrollToQuestionnaire()" class="text-xs text-primary hover:underline font-semibold flex items-center gap-1">
                                            <i class="fa-solid fa-arrow-up text-[10px]"></i>
                                            מלא שאלון לשיפור
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Action Card - Replace with Matching Roles Counter -->
                            <div class="bg-gradient-to-br from-secondary/10 to-secondary/20 p-4 rounded-card border-2 border-secondary/30 hover:border-secondary/50 transition-all">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-card flex-shrink-0">
                                        <i class="fa-solid fa-briefcase text-secondary text-xl" aria-hidden="true"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-xs text-neutral-dark font-medium mb-1">משרות מתאימות מעל 75%</p>
                                        <p class="text-2xl font-bold text-secondary">{{ employeeStore.metrics()!.matching_jobs_count }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Skills & Education Section - TOP 5 with Color Separation -->
                <section id="skills-education" class="bg-white p-6 rounded-card shadow-card" aria-labelledby="skills-heading">
                    <div class="flex items-center justify-between mb-6">
                        <h2 id="skills-heading" class="text-xl font-bold text-primary flex items-center gap-2">
                            <i class="fa-solid fa-sparkles" aria-hidden="true"></i>
                            המיומנויות וההשכלה שלי
                        </h2>
                        <button class="text-sm text-primary hover:underline font-semibold flex items-center gap-1">
                            כלל המיומנויות
                            <i class="fa-solid fa-arrow-left text-xs"></i>
                        </button>
                    </div>

                    <!-- Soft Skills Row - TOP 5 -->
                    <div class="mb-6 bg-accent/5 p-4 rounded-card border-2 border-accent/20">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fa-solid fa-brain text-accent-dark text-lg" aria-hidden="true"></i>
                            <h3 class="font-semibold text-accent-dark">TOP 5 מיומנויות בין אישיות</h3>
                        </div>
                        <div class="flex flex-wrap gap-2" role="list" aria-label="רשימת מיומנויות בין אישיות">
                            <span *ngFor="let skill of employeeStore.softSkills()" class="bg-accent/30 text-accent-dark px-4 py-2 rounded-pill text-sm font-bold border-2 border-accent/50 shadow-sm" role="listitem">{{ skill }}</span>
                        </div>
                    </div>

                    <!-- Hard Skills Row - TOP 5 -->
                    <div class="bg-primary/5 p-4 rounded-card border-2 border-primary/20">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fa-solid fa-code text-primary text-lg" aria-hidden="true"></i>
                            <h3 class="font-semibold text-primary">TOP 5 מיומנויות תפקיד</h3>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-white p-3 rounded-card border-r-4 border-primary shadow-sm">
                                <div class="flex items-center gap-2 mb-1">
                                    <i class="fa-solid fa-graduation-cap text-primary text-sm" aria-hidden="true"></i>
                                    <p class="text-xs text-neutral-dark font-bold uppercase tracking-wide">השכלה</p>
                                </div>
                                <p class="font-bold text-primary text-sm">{{ employeeStore.profile()!.education.degree }}</p>
                                <p class="text-xs text-neutral-dark mt-0.5">{{ employeeStore.profile()!.education.institution }}</p>
                            </div>

                            <div class="bg-white p-3 rounded-card border-r-4 border-primary shadow-sm">
                                <div class="flex items-center gap-2 mb-1">
                                    <i class="fa-solid fa-star text-primary text-sm" aria-hidden="true"></i>
                                    <p class="text-xs text-neutral-dark font-bold uppercase tracking-wide">התמחות</p>
                                </div>
                                <p class="font-bold text-primary text-sm">{{ employeeStore.profile()!.specialization.main }}</p>
                                <p class="text-xs text-neutral-dark mt-0.5">{{ employeeStore.profile()!.specialization.area }}</p>
                            </div>
                        </div>

                        <div>
                            <p class="text-xs text-neutral-dark mb-2 font-bold">טכנולוגיות עיקריות:</p>
                            <div class="flex flex-wrap gap-2" role="list" aria-label="רשימת טכנולוגיות">
                                <span *ngFor="let skill of employeeStore.hardSkills()" class="bg-primary/20 text-primary px-4 py-2 rounded-pill text-sm font-bold border-2 border-primary/40 shadow-sm" role="listitem">{{ skill }}</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Matching Opportunities Section -->
                <section id="matching-opportunities" class="bg-white rounded-card shadow-card overflow-hidden">
                    <!-- Header with gradient background -->
                    <div class="bg-gradient-to-l from-primary/10 via-accent/10 to-primary/10 p-6 border-b-2 border-primary/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-primary mb-1">משרות מותאמות עבורך</h2>
                                <p class="text-neutral-medium text-sm">על בסיס הכישורים הקשים והרכים שלך · בחר/י משרה לצפייה בתוכנית פיתוח מותאמת</p>
                            </div>
                            <button class="text-primary hover:underline font-semibold text-sm flex items-center gap-2">
                                צפה בכל ההזדמנויות ({{ positionsStore.positionsCount() }} משרות)
                                <i class="fa-solid fa-arrow-left"></i>
                            </button>
                        </div>
                    </div>

                    <div class="p-6">
                        <div class="grid grid-cols-3 gap-5">
                            <!-- Dynamic Position Cards -->
                            <div *ngFor="let position of positionsStore.positions()" 
                                 class="job-card relative border-2 rounded-card p-5 hover:shadow-panel transition-all cursor-pointer"
                                 [ngClass]="getCategoryBorderClass(position.category_color)"
                                 [class.ring-2]="positionsStore.selectedPositionId() === position.id" 
                                 [class.ring-primary]="positionsStore.selectedPositionId() === position.id"
                                 (click)="selectPosition(position.id)">
                                <!-- Category Tag at Top -->
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-xs px-3 py-1.5 rounded-pill font-bold border"
                                          [ngClass]="getCategoryTagClass(position.category_color)">
                                        <i [class]="'fa-solid ' + position.category_icon + ' ml-1'"></i>{{ position.category }}
                                    </span>
                                    <div class="text-center">
                                        <div class="relative w-16 h-16">
                                            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                                <path class="text-neutral-light" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3"></path>
                                                <path [ngClass]="getProgressColorClass(position.category_color)" [attr.stroke-dasharray]="position.match_percentage + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"></path>
                                            </svg>
                                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
                                                <p class="text-lg font-bold leading-none" [ngClass]="getMatchTextClass(position.category_color)">{{ position.match_percentage }}%</p>
                                                <p class="text-[9px] font-semibold mt-0.5 leading-none" [ngClass]="getMatchTextClass(position.category_color)">התאמה {{ position.match_level }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <h3 class="font-bold text-xl text-primary mb-2">{{ position.title }}</h3>
                                <p class="text-neutral-medium text-sm mb-3">{{ position.division }} | {{ position.location }} | {{ position.work_model }}</p>
                                
                                <!-- Position Description -->
                                <p class="text-sm text-neutral-dark mb-3 leading-relaxed">{{ position.description }}</p>

                                <!-- Required Skills -->
                                <div class="mb-4 bg-neutral-extralight rounded-card p-3">
                                    <p class="text-xs font-bold text-neutral-dark mb-2">דרישות עיקריות:</p>
                                    <div class="space-y-1.5">
                                        <div *ngFor="let req of position.requirements" class="flex items-start gap-2 text-xs">
                                            <i class="fa-solid fa-circle text-[6px] mt-1" [ngClass]="getRequirementDotClass(position.category_color)"></i>
                                            <span class="text-neutral-dark">{{ req.skill }} - {{ req.status }}</span>
                                        </div>
                                    </div>
                                </div>

                                <button class="w-full bg-primary text-white py-2.5 rounded-card text-sm font-semibold hover:bg-primary-dark transition-colors focus:outline-none focus:ring-2 focus:ring-primary">
                                    <i class="fa-solid fa-eye ml-2"></i>צפה בפירוט המשרה
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- IDP Section - Initially Hidden -->
                <section *ngIf="showIDP() && positionsStore.selectedPosition() && employeeStore.idpProgress()" id="idp-connected" class="bg-white rounded-card shadow-card overflow-hidden border-t-4 border-primary" aria-labelledby="idp-heading">
                    <!-- Visual Connection Element -->
                    <div class="relative bg-gradient-to-l from-primary/5 via-accent/5 to-primary/5 py-6">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t-2 border-dashed border-primary/30"></div>
                        </div>
                        <div class="relative flex justify-center">
                            <div class="bg-white px-6 py-2 flex items-center gap-3 border-2 border-primary/30 rounded-pill shadow-sm">
                                <i class="fa-solid fa-link text-primary text-xl"></i>
                                <span class="font-bold text-primary">תוכנית הפיתוח מותאמת למשרה שבחרת</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-l from-primary/10 via-accent/10 to-primary/10 p-6 border-b-2 border-primary/20">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-primary rounded-lg flex items-center justify-center shadow-card">
                                    <i class="fa-solid fa-route text-white text-xl"></i>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-primary mb-1">תוכנית הפיתוח שלי</h2>
                                    <div class="flex items-center gap-3">
                                        <p class="text-sm text-neutral-medium">מותאמת אישית לתפקיד:</p>
                                        <div class="flex items-center gap-2 bg-white px-4 py-1.5 rounded-pill shadow-sm border-2 border-primary">
                                            <i class="fa-solid fa-briefcase text-primary text-sm"></i>
                                            <span class="font-bold text-primary">{{ positionsStore.selectedPositionTitle() }}</span>
                                            <div class="w-px h-4 bg-primary/30"></div>
                                            <div class="flex items-center gap-1">
                                                <span class="text-xs text-neutral-medium">התאמה:</span>
                                                <span class="font-bold text-primary">{{ positionsStore.selectedPositionMatch() }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button (click)="closeIDP()" class="text-primary hover:underline text-sm font-semibold flex items-center gap-2 bg-white px-4 py-2.5 rounded-card shadow-sm border border-primary/20 hover:border-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                <i class="fa-solid fa-times ml-1"></i>
                                סגור תוכנית
                            </button>
                        </div>
                    </div>

                    <div class="p-6">
                        <!-- Progress Overview -->
                        <div class="grid grid-cols-4 gap-4 mb-8">
                            <div class="bg-gradient-to-br from-primary/5 to-primary/10 p-4 rounded-card border-r-4 border-primary">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-neutral-medium">התקדמות כללית</span>
                                    <i class="fa-solid fa-chart-line text-primary"></i>
                                </div>
                                <p class="text-3xl font-bold text-primary mb-1">{{ employeeStore.idpProgress()!.overall }}%</p>
                                <div class="w-full bg-neutral-light rounded-full h-2">
                                    <div class="bg-primary h-2 rounded-full transition-all" [style.width.%]="employeeStore.idpProgress()!.overall"></div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-accent/5 to-accent/10 p-4 rounded-card border-r-4 border-accent">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-neutral-medium">פערים נותרו</span>
                                    <i class="fa-solid fa-exclamation-triangle text-accent-dark"></i>
                                </div>
                                <p class="text-3xl font-bold text-accent-dark mb-1">{{ employeeStore.idpProgress()!.gaps_remaining }}</p>
                                <p class="text-xs text-neutral-medium">מתוך {{ employeeStore.idpProgress()!.gaps_total }} פערים</p>
                            </div>

                            <div class="bg-gradient-to-br from-status-success/5 to-status-success/10 p-4 rounded-card border-r-4 border-status-success">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-neutral-medium">משימות הושלמו</span>
                                    <i class="fa-solid fa-check-circle text-status-success"></i>
                                </div>
                                <p class="text-3xl font-bold text-status-success mb-1">{{ employeeStore.idpProgress()!.tasks_completed }}</p>
                                <p class="text-xs text-neutral-medium">מתוך {{ employeeStore.idpProgress()!.tasks_total }} משימות</p>
                            </div>

                            <div class="bg-gradient-to-br from-accent/5 to-accent/10 p-4 rounded-card border-r-4 border-accent">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-neutral-medium">זמן משוער</span>
                                    <i class="fa-solid fa-clock text-accent-dark"></i>
                                </div>
                                <p class="text-3xl font-bold text-accent-dark mb-1">{{ employeeStore.idpProgress()!.estimated_months }}</p>
                                <p class="text-xs text-neutral-medium">חודשים להשלמה</p>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-3 mt-8 pt-6 border-t border-neutral-light">
                            <button class="flex-1 bg-accent-dark text-white py-3 rounded-card font-semibold hover:bg-accent-dark/90 transition-colors focus:outline-none focus:ring-2 focus:ring-accent-dark focus:ring-offset-2">
                                <i class="fa-solid fa-plus ml-2"></i>הוסף משימה חדשה
                            </button>
                            <button class="flex-1 bg-primary-light text-primary py-3 rounded-card font-semibold hover:bg-primary/10 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                <i class="fa-solid fa-download ml-2"></i>ייצא תוכנית PDF
                            </button>
                            <button class="px-6 py-3 border-2 border-primary text-primary rounded-card font-semibold hover:bg-primary/5 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                <i class="fa-solid fa-share-nodes ml-2"></i>שתף עם מנהל
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Sidebar -->
            <div class="col-span-3 space-y-6 sticky top-24">
                <!-- Matching Questionnaire Card -->
                <div id="matching-questionnaire" class="bg-white p-6 rounded-card shadow-card border-t-4 border-accent" aria-labelledby="questionnaire-heading">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="fa-solid fa-list-check text-accent-dark text-2xl" aria-hidden="true"></i>
                        <h3 id="questionnaire-heading" class="text-lg font-bold text-primary">שאלון התאמה</h3>
                    </div>
                    <p class="text-sm text-neutral-dark mb-4">עזור/י לנו לדייק את ההתאמות עבורך. השלמת השאלון תשפר את איכות הנתונים שלך.</p>
                    <a routerLink="/questionnaire" class="block w-full bg-accent-dark text-white font-bold py-3 rounded-card hover:bg-accent-dark/90 transition-colors focus:outline-none focus:ring-2 focus:ring-accent-dark focus:ring-offset-2 text-center">
                        התחל/י שאלון (5 דק')
                        <i class="fa-solid fa-arrow-left ml-2 text-xs" aria-hidden="true"></i>
                    </a>
                </div>

                <!-- AI Guidance Card -->
                <div id="ai-guidance" class="bg-gradient-to-br from-primary to-accent-dark text-white p-6 rounded-card shadow-panel" aria-labelledby="ai-heading">
                    <div class="flex items-center gap-3 mb-4">
                        <i class="fa-solid fa-robot text-2xl" aria-hidden="true"></i>
                        <h3 id="ai-heading" class="text-lg font-bold">הכוונה חכמה</h3>
                    </div>
                    <p class="text-sm mb-4">התייעצ/י עם ה-AI שלנו כדי לקבל הכוונה אישית למסלול הקריירה שלך.</p>
                    
                    <div class="relative mb-3">
                        <label for="ai-question" class="sr-only">שאל/י שאלה</label>
                        <textarea id="ai-question" rows="3" placeholder="שאל/י אותי כל דבר..." class="w-full bg-white/20 border-2 border-white/30 rounded-card p-3 text-sm text-white placeholder:text-white/70 focus:outline-none focus:ring-2 focus:ring-white focus:border-white transition-colors"></textarea>
                    </div>

                    <div class="space-y-2 mb-4 text-xs">
                        <p class="font-semibold">נסה/י לשאול:</p>
                        <button class="block w-full text-right bg-white/15 hover:bg-white/25 p-2.5 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-white border border-white/20">"מה כדאי לי ללמוד כדי להתקדם בארגון?"</button>
                        <button class="block w-full text-right bg-white/15 hover:bg-white/25 p-2.5 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-white border border-white/20">"מה התפקיד שהכי מתאים לי כרגע?"</button>
                    </div>

                    <button class="w-full bg-white text-primary font-bold py-3 rounded-card hover:bg-neutral-extralight transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary">
                        <i class="fa-solid fa-paper-plane ml-2" aria-hidden="true"></i>
                        שלח/י שאלה
                    </button>
                </div>
            </div>
        </div>
    </main>
</ng-container>
